package Entities.StandingOrders;import Entities.Transactions.Rails.PaymentRail;import Entities.Transactions.Requests.PaymentRequest;import Entities.Users.Bills;import Managers.BillManager;import java.time.LocalDate;public class PaymentOrder extends StandingOrder {    private String RFCode;    public PaymentOrder(String executorID, String orderId, String title, String description,                        LocalDate startDate, LocalDate endDate, double maxAmount,                        OrderStatus status, String RFCode, String chargeIBAN,  int attempts,double executionFee) {        super(executorID,orderId, title, description,  startDate, endDate, maxAmount, status,chargeIBAN,attempts,executionFee);        this.RFCode = RFCode;    }    public String getRFCode() { return RFCode; }    @Override    public void computeNextExecutionDate(LocalDate today) {        Bills bill = BillManager.getInstance().findBill(RFCode);        if(bill == null){            setExecutionDate(LocalDate.MAX);        }        else {            setExecutionDate(!today.isBefore(bill.getDueDate().minusDays(3-getAttempts())) ? today : bill.getDueDate().minusDays(3-getAttempts()));            if(getExecutionDate().isAfter(bill.getDueDate())){                status = OrderStatus.CANCELED;            }        }    }    @Override    public String getType() { return "PAYMENT_ORDER"; }    @Override    public boolean executeOrder() {        if(amount > maxAmount){            setFailureReason("Amount is greater than max amount");            return false;        }        PaymentRail paymentRail = new PaymentRail();        PaymentRequest paymentRequest = new PaymentRequest(getChargeIBAN(),RFCode,executorID,executionFee);        Boolean isSuccessfull = paymentRail.execute(paymentRequest);        if(!isSuccessfull){            setFailureReason(paymentRail.getMessage());            attempts++;        }        else{            setAttempts(0);        }        return isSuccessfull;    }    @Override    public double getAmount() {        Bills bill = BillManager.getInstance().findBill(RFCode);        return bill!=null? bill.getAmount() : 0;    }    @Override    public String marshal() {        return marshalBase() +                ",type:PAYMENT_ORDER" +                ",RFCode:" + RFCode +                ",sourceIBAN:" + getChargeIBAN();    }}